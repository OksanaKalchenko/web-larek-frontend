# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении
- Интерфейс, описывающий карточку товара:

```
interface IProduct {
	id: string; // Уникальный идентификатор товара
	description: string; // Описание товара
	image: string; // URL изображения товара
	title: string; // Наименование товара
	category: TCategoryType; // Категория товара
	price: number | null; //Цена товара
}
```

- Интерфейс, расширяющий IProduct, добавляет индекс товара в корзине:

```
interface IProductInBasket extends IProduct {
    index: number; // Индекс продукта в корзине
  }
```

- Интерфейс, описывающий форму для заполнения пользователем личных данных при оформлении заказа:

```
interface IContactForm {
    email: string; // Электронная почта пользователя
    phone: string; // Номер телефона пользователя
}
```
- Интерфейс, описывающий форму для выбора пользователем способа оплаты и заполнения адреса доставки при оформлении заказа:

```
interface IOrderForm {
    payment: TPayMethod; // Способ оплаты
    address: string; // Адрес доставки
}
```
- Интерфейс, расширяющий IContactForm и IOrderForm:

```
interface IOrder extends IOrderForm, IContactForm {
	total: number; // Общая сумма заказа
	items: string[]; // Список товаров, включенных в заказ
}
```
- Интерфейс, описывающий глобальное состояние приложения:

```
interface IAppState {
    catalog: IProduct[];  // Массив продуктов в каталоге
    basket: string[];   // Массив продуктов в корзине
    preview: string | null;
    order: IOrder | null;

    setCatalog(items: IProduct[]): void; // Выводит каталог на страницу
    addProduct(product: IProduct): void; // Добавляет продукт в корзину
    removeProduct(product: IProduct): void; // Удаляет продукт из корзины
}
```
- Интерфейс, описывающий типы свойств итогового заказа:

```
interface IOrderResult {
    id: string; // ID товара
    total: number; // Итоговая сумма
}
```
- Тип оплаты заказа:

```
type TCategoryType = 'другое' | 'софт-скил' | 'дополнительное' | 'кнопка'| 'хард-скил';
```


- Данные карточки товара, используемые при добавлении товара в корзину:

```
type TProductBasket = Pick<IProduct, 'id' | 'price' | 'title'>;
```
- Данные, которые вводятся в формы при оформлении заказа:

```
type TOrderFormData = Pick<IOrder, 'payment' | 'address' | 'email' | 'phone'>;
```
- Ошибки в форме заказа:

```
type TFormErrors = Partial<Record<keyof IOrder, string>>;
```


## Архитектура приложения

- слой представления отечает за отображение данных на странице;

- слой данных отвечает за хранение и изменение данных;

- презентер отвечает за связь представления и данных.

# Базовый код 

### 1. Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### 2. Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие;
- `emit` - инициализация события;
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### 3. Абстрактный класс Component

Базовый абстрактный класс, является основой для создания и отображения компонентов проекта. 

Конструктор класса: 

`container: HTMLElement` - принимает элемент контейнера, в который будет помещен компонент.

Методы класса:

- `toggleClass(element: HTMLElement, className: string, force?: boolean)` - переключить класс;
- `setText(element: HTMLElement, value: unknown)` - установить текстовое содержимое;
- `setDisabled(element: HTMLElement, state: boolean)` - сменить статус блокировки;
- `setHidden(element: HTMLElement)` - скрыть;
- `setVisible(element: HTMLElement)` - показать;
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - установить изображение с алтернативным текстом;

Основной метод `render` заполняет свойства элемента данными и возвращает его в формате HTMLElement.

### 4. Абстрактный класс Model

Базовая абстрактная модель, чтобы можно было отличить ее от простых объектов с данными. Это абстрактный класс, который является шаблоном для создания новых моделей данных.

Конструктор класса:

`data: Partial` — данные;

`events: IEvents` — объект событий.

Метод `emitChanges` сообщает об изменении данных в модели.

## Слой данных

### Класс AppState

Класс AppState описывает состояние приложения.

Поля класса:

- `catalog` - массив продуктов IProduct, каталог;
- `basket` - массив продуктов IProduct, корзина;
- `preview` - id карточки, выбранной для просмотра в модальном окне, является строкой или null;
- `order` - представляет информацию о заказе, включая общую стоимость заказа (total), список товаров (items), номер телефона (phone), электроннаую почту (email), способ оплаты (payment) и адрес доставки (address);
- `formErrors: FormErrors = {}` - объект ошибок формы оформления заказа.

Методы класса:

- setCatalog(items: IProduct[]) - выводит каталог на страницу;
- setPreview(item: Product): void - устанавливает товар для предпросмотра
- addProduct(item: Product): void - добавляет продукт в корзину;
- deleteProduct(item: Product): void - удаляет продукт из корзины;
- clearBasket() - очищает корзину;
- setOrderField(field: keyof IOrderForm, value: string) - устанавливает значение в поле заказа и проверяет его;
- validateOrder() - проверяет значение полей в форме доставки;
- setContactField(field: keyof IContactForm, value: string) - устанавливает значение в поле контактов;
- validateContacts() - проверяет значение полей в форме контактов;
- getTotal(): number - возвращает общую сумму заказов;
- resetOrder() - очищает данные заказа.


## Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.


### 1. Класс Modal

Наследуется от класса Component. Управляет поведением модальных окон.

Конструктор класса:

constructor(container: HTMLElement, events: IEvents) - Конструктор принимает темплейт, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

Поля класса:

`_closeButton: HTMLButtonElement` - кнопка закрытия модального окна;

`_content: HTMLElement` - содержимое модального окна.

Методы класса:

- `set content` - выводит на экран подготавливаемую и возвращаемую из `render` разметку;
- `open` - открывает модальное окно;
- `close` - закрывает модальное окно;
- `render` - устанавливает содержимое модального окна. Возвращает корневой DOM-элемент для отрисовки.


### 2. Класс Card

Представляет собой компонент карточки товара, наследуется от класса Component, предназначается для отображения и управления карточками товара.


Конструктор класса:

`container: HTMLElement` — принимает элемент контейнера для вставки карточки;
`actions?: ICardActions` — действия для установки на слушатели событий.

Методы класса:

- `set/get id` - управляет индификатором карточки;
- `set/get title` - управляет названием товара;
- `set image` - устанавливает изображение товара;
- `set description` - устанавливает описание товара;
- `set/get category` - управляет категорией и ее цветом;
- `set price` - управляет ценой товара;
- `set index` - управляет индексом товара;
- `set buttonTitle` - устанавливает текст кнопки;
- `disablePriceButton ()` - проверяет цену и делает кнопку покупки неактивной если цена не указана;


### 3. Класс Form

Предназначен для формирования и управления формами, наследует базовый класс Component. 

Конструктор класса:

`constructor( container: HTMLFormElement, events: IEvents)` - принимает контейнер формы и объект для управления событиями.

Поля класса:

`submit: HTMLButtonElement` - DOM элемент кнопки отправки формы;

`errors: HTMLElement` - DOM элемент отображения ошибки валидации формы.

Методы класса:

- `onInputChange` - метод вызывается при изменении значений в полях формы;
- `set valid` - управляет кнопкой отправки формы в зависимости от валидации;
- `render` - рендер, обновляет состояние валидности формы;
- `set errors` - устанавливает ошибки валидации формы.


### 4. Классы OrderForm и ContactForm

Наследуют класс Form, включают в себя выбор способа оплаты, указание контактных данных и адреса пользователя. 

Конструктор классов:

`container: HTMLElement` — контейнер для вставки данных;

`events: IEvents` — объект событий.

Методы класса OrderForm:

`select payment` - принимает имя кнопки и устанавливает класс активности;

`set address` - устанавливает значение поля адреса в форме;

Методы класса ContactForm:

`set phone` - устанавливает значение номера телефона;

`set email` - устанавливает значение электронной почты.

### 5. Класс Success

Наследуется от класса Component. Отображает модальное окно об успешном заказе.

Конструктор класса:

`container: HTMLElement, actions: ISuccessActions`

Метод `total` - устанавливает значение общей суммы заказа


### 6. Класс Page

Наследуется от класса Component. Управляет элементами страницы: счетчик товаров в корзине, каталог товаров, блокировка прокрутки страницы при открытии модального окна.


Конструктор класса:

`container: HTMLElement` — контейнер для вставки карточек;

`events: IEvents` — объект событий.

Методы класса:

- `set counter` - уставливает счетчик товаров в корзине;
- `set catalog` - выводит каталог продуктов;
- `set locked` - управляет блокировкой прокрутки страницы при открытии модального окна.


### 7. Класс Basket

Класс наследуется от базового класса Component. Отвечает за работу с корзиной, отражает информацию по товарам в корзине, стоимость каждой единицы товара, дает возможность удалить товар из корзины, считает и показывает общую сумму заказа.

Конструктор класса:

`container: HTMLElement` — контейнер для вставки данных;

`events: IEvents` — объект событий.


Методы класса:

- `set items` - устанавливает элементы корзины;
- `set total` - устанавливаем общую стоимость товаров в корзине;
- `set selected` - устанавливает состояние кнопки  button в зависимости от наличия товаров в корзине.

### 8. Класс LarekApi

Наследуется от класса Api. Взаимодействует с сервером.

Методы класса:

- `getProductList` - получает список продуктов и их данные;
- `getProductItem` - получает данные продукта;
- `getOrder` - отправляет заказ и получает ответ.


## Слой коммуникации

### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой, находится в файле index.ts, выполняющий роль презентера.
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts.
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

В приложении происходит в результате действия пользователя встроенное браузерное событие -> В обработчике этого события вызывается обработчик генерируемого события через метод-посредник emit. Этот обработчик вызывает метод класса модели данных для алгоритмической обработки встроенного события -> Подготовленные в методе класса модели в результате этой обработки данные, через метод посредника emit передаются классу представления для их отображения.

То есть, в терминах MVP каждую цепочку действий в проекте можно описать следующей цепочкой:
V --> P --> M --> P --> V, где
V - означает класс слоя View,
P - означает метод презентера Present
M - означает класс слоя Model, 
--> означает переход выполнения приложения из одной сущности в другую.

Список событий, которые могут генерироваться в системе:

События изменения данных (генерируются моделью данных)

- `products:changed` - изменение каталога товаров;
- `basket:changed` - изменение состояния корзины (добавили или удалили товар);
- `order:ready` - данные по заказу прошли валидацию и готовы к отправке на сервер;


События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)

- `modal:open` - открытие модального окна;
- `modal:close` - закрытие модального окна;
- `product:select` - клик по карточке товара в каталоге. Отображает детали выбранного продукта;
- `basket:open` - открытие корзины;
- `order:open` - открытие формы выбора способа оплаты и адреса доставки;
- `payment:changed` - выбор способа оплаты;
- `address:input` - ввод адреса доставки заказа;
- `order:submit` - подтверждение данных для оплаты и доставки;
- `email:input` - ввод почтового адреса клиента;
- `phone:input` - ввод телефона клиента;
- `contacts:submit` - подтверждение контактных данных.


